version: "2"
otel-logs-pipeline:
  source:
    otel_logs_source:
      path: "/logs/onebyone"
  processor:
  - parse_json:
      source: "body"
  - parse_json:
      source: "kubernetes"
  - parse_json:
      source: "annotations"
  - parse_json:
      source: "labels"
  - delete_entries:
      with_keys: ["body", "kubernetes", "annotations", "labels"]
  - date:
      from_time_received: true
      destination: "@timestamp"
  sink:
  - opensearch:
      index: "logs_onebyone"
      hosts: ["https://${aws_opensearch_domain.opensearch.endpoint}"]
      aws:
        sts_role_arn: "${aws_iam_role.opensearch_injest.arn}"
        region: "${local.region}":
